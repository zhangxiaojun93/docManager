(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{360:function(e,t,s){"use strict";s.r(t);var a=s(2),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"站内消息发送说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#站内消息发送说明"}},[e._v("#")]),e._v(" "),s("strong",[e._v("站内消息发送说明")])]),e._v(" "),s("hr"),e._v(" "),s("h3",{attrs:{id:"_1-功能概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-功能概述"}},[e._v("#")]),e._v(" "),s("strong",[e._v("1. 功能概述")])]),e._v(" "),s("ul",[s("li",[e._v("站内消息推送为接入系统提供站内消息发送以及接收能力")]),e._v(" "),s("li",[e._v("支持跨系统消息推送功能")]),e._v(" "),s("li",[e._v("可通过websocket方式接收消息")]),e._v(" "),s("li",[e._v("可通过ajax轮询方式接收消息")])]),e._v(" "),s("h3",{attrs:{id:"_2-接入流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-接入流程"}},[e._v("#")]),e._v(" "),s("strong",[e._v("2. 接入流程")])]),e._v(" "),s("ul",[s("li",[s("p",[e._v("weboscket接入流程")]),e._v(" "),s("ul",[s("li",[e._v("接入服务器\n"),s("ul",[s("li",[e._v("前端需配置websocket服务地址\n"),s("ul",[s("li",[e._v("示例")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('    const WSURL = "ws://localhost:8081/git/websocket";\n')])])])]),e._v(" "),s("li",[e._v("当连接成功后发送一条包含系统编码和当前用户id的消息到websocket服务，以绑定当前用户\n"),s("ul",[s("li",[e._v("示例")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('    const SYSTEMCODE = "PORTAL";\n    const USERID = parent.indexTool.getUserInfo().userId;\n    let actions = {};\n    actions.systemCode_userId = SYSTEMCODE + "_" + USERID;\n    this.websocket.send(JSON.stringify(actions));\n')])])]),s("em",[e._v('注：消息内容的key值必须为"systemCode_userId"')])])])]),e._v(" "),s("li",[e._v("接收消息\n"),s("ul",[s("li",[e._v("接收消息参数\n"),s("ul",[s("li",[e._v("示例")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('    {\n    \t"messageContent": "站内消息推送示例-内容：321",\n    \t"messageTitle": "站内消息推送示例-标题：123",\n    \t"sendUserId": "1"\n    }\n')])])])]),e._v(" "),s("li",[e._v("示例")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('    // 数据接收\n    websocketonmessage(msgData) {\n        if (msgData && msgData.data) {\n            let msg = JSON.parse(msgData.data);\n            this.$message.success(msg.messageContent);\n            let messageInfo = "接收到用户id为" + msg.sendUserId + "发送的消息，消息标题：" + msg.messageTitle +"　消息内容：" + msg.messageContent;\n            this.list.push(messageInfo);\n            console.log(msg);\n        }\n    }\n')])])])])])]),e._v(" "),s("li",[s("p",[e._v("ajax轮询接入说明")]),e._v(" "),s("ul",[s("li",[e._v("调用查询地址\n"),s("ul",[s("li",[e._v("示例")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("     http://localhost:8081/git/api/webSiteMessage/queryLatestNotReadWebSiteMessage\n")])])]),s("ul",[s("li",[e._v("请求方式\nGET")])])]),e._v(" "),s("li",[e._v("调用查询地址传入参数\n"),s("ul",[s("li",[e._v("rsystemCode 接收系统编码")]),e._v(" "),s("li",[e._v("receiveUserid 接收用户id")])])]),e._v(" "),s("li",[e._v("返回值\n"),s("ul",[s("li",[e._v("示例")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('    {\n    \t"msg": "查询成功！",\n    \t"result": {\n    \t\t"id": "24a8cc16c7454dcd9c11e4c37e23a883",\n    \t\t"receiveUserid": "1",\n    \t\t"rsystemCode": "PORTAL",\n    \t\t"messageTitle": "站内消息推送示例-标题：123",\n    \t\t"messageContent": "站内消息推送示例-内容：321",\n    \t\t"read": "0",\n    \t\t"sendUserId": "1"\n    \t},\n    \t"code": "200",\n    \t"requestId": "eecf171b-e0bc-4206-b061-df32fb448d42",\n    \t"success": true\n    }\n')])])])]),e._v(" "),s("li",[e._v("查询方法\n"),s("ul",[s("li",[e._v("示例")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("    fnQueryLatestNotReadWebSiteMessage(){\n        let vue = this;\n        //解决axios请求传入参数是json问题\n        let data= new URLSearchParams();\n        data.append('rsystemCode',SYSTEMCODE);\n        data.append('receiveUserid',USERID);\n        Axios({\n            method: 'post',\n            url: faceConfig.basePath + \"/api/webSiteMessage/queryLatestNotReadWebSiteMessage\",\n            withCredentials:true,//携带cookies\n            params: data\n        }).then((response) => {\n            let resultInfo = response.data;\n            if(resultInfo.code === \"200\"){\n                if(resultInfo.result != null){\n                    //当此消息第一次被查询出来时弹出，同时记录此消息id\n                    if(vue.messageId !== resultInfo.result.id){\n                        vue.$message.success(resultInfo.result.messageContent);\n                        vue.messageId = resultInfo.result.id;\n                    }\n                }\n            }\n        });\n    }\n")])])]),s("em",[e._v("注：后台查询出来的始终是最近一次的未读消息，所以如果不想每一次该条消息都展示出来，需要进行处理")])]),e._v(" "),s("li",[e._v("轮询接收消息（10秒查询一次）\n"),s("ul",[s("li",[e._v("示例")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("    this.myInterval = window.setInterval(() => {\n      setTimeout(() => {\n        this.fnQueryLatestNotReadWebSiteMessage();\n      }, 1)\n    }, 10000);\n")])])])])])]),e._v(" "),s("li",[s("p",[e._v("发送消息")]),e._v(" "),s("ol",[s("li",[e._v("新增接入系统，若其他渠道已新增不必新增，新增时必须选定需要发送的渠道，没有选择则没有该渠道发送权限")]),e._v(" "),s("li",[e._v("按照消息发送api提供消息主体和消息子体中所需内容，再调用接口即可")])])])]),e._v(" "),s("h3",{attrs:{id:"_3-接口说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-接口说明"}},[e._v("#")]),e._v(" "),s("strong",[e._v("3. 接口说明")])]),e._v(" "),s("ol",[s("li",[e._v("站内消息发送统一调用消息发送接口，消息发送类型（sendType）为 “0”")]),e._v(" "),s("li",[e._v("站内消息无群发、分组发送，指定无效")])]),e._v(" "),s("h3",{attrs:{id:"_4-参数说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-参数说明"}},[e._v("#")]),e._v(" "),s("strong",[e._v("4. 参数说明")])]),e._v(" "),s("ul",[s("li",[e._v("receiveUserid 接收人id")]),e._v(" "),s("li",[e._v("rsystemCode 接收系统编码\n"),s("em",[e._v("注：同一批次消息的接收人和接收系统不可同时相同")])])]),e._v(" "),s("h3",{attrs:{id:"_5-调用示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-调用示例"}},[e._v("#")]),e._v(" "),s("strong",[e._v("5. 调用示例")])]),e._v(" "),s("ul",[s("li",[s("p",[e._v("内容一致")]),e._v(" "),s("ul",[s("li",[e._v("isSameBatchContent为true，不指定默认为true")]),e._v(" "),s("li",[e._v("示例"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('    {\n    \t"sendUserid": "1",\n    \t"businessCode": "si_yzm",\n    \t"areaCode": "512000",\n    \t"sendName": "王小二",\n    \t"ticket": "5FF81A730D53AF84B679E5F890650920",\n    \t"sendType": "0",\n    \t"ssystemCode": "TEST4",\n    \t"messageTitle": "123",\n    \t"messageContent": "123456789",\n    \t"items": [{\n    \t\t"receiveUserid": "22",\n    \t\t"rsystemCode": "AUTH"\n    \t}, {\n    \t\t"receiveUserid": "33",\n    \t\t"rsystemCode": "PORTAL"\n    \t}]\n    }\n')])])])])])]),e._v(" "),s("li",[s("p",[e._v("内容不一致")]),e._v(" "),s("ul",[s("li",[e._v("isSameBatchContent为false")]),e._v(" "),s("li",[e._v("示例"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('    {\n    \t"sendUserid": "1",\n    \t"businessCode": "si_yzm",\n    \t"areaCode": "512000",\n    \t"sendName": "王小二",\n    \t"ticket": "5FF81A730D53AF84B679E5F890650920",\n    \t"sendType": "0",\n    \t"ssystemCode": "TEST4",\n    \t"messageTitle": "123",\n    \t"messageContent": "123456789",\n    \t"items": [{\n    \t\t"messageTitle": "123",\n    \t\t"messageContent": "123456789",\n    \t\t"receiveUserid": "22",\n    \t\t"rsystemCode": "AUTH"\n    \t}, {\n    \t\t"messageTitle": "123",\n    \t\t"messageContent": "123456789",\n    \t\t"receiveUserid": "33",\n    \t\t"rsystemCode": "PORTAL"\n    \t}]\n    }\n')])])])])])])]),e._v(" "),s("h3",{attrs:{id:"_6-示例下载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-示例下载"}},[e._v("#")]),e._v(" "),s("strong",[e._v("6. 示例下载")])]),e._v(" "),s("p",[s("a",{attrs:{href:"static/apiDoc/demo/SendwebSiteMessageDemo/websitePoll.vue",download:"",target:"_blank"}},[e._v("轮询页面下载")]),e._v(" "),s("a",{attrs:{href:"static/apiDoc/demo/SendwebSiteMessageDemo/websiteWebsocket.vue",download:"",target:"_blank"}},[e._v("websocket页面下载")]),e._v(" "),s("a",{attrs:{href:"static/apiDoc/demo/SendwebSiteMessageDemo/SendWebSiteMessageDemo.java",download:"",target:"_blank"}},[e._v("SendWebSiteMessageDemo下载")])])])}),[],!1,null,null,null);t.default=n.exports}}]);